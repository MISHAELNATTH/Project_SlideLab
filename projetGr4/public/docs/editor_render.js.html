

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title> editor/render.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                <a
                    href="../index.html"
                    class="link"
                >
                    Retour vers SlideLab
                </a>
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Global</h3><ul><li><a href="global.html#addSlide">addSlide</a></li><li><a href="global.html#applyCameraTransform">applyCameraTransform</a></li><li><a href="global.html#applyTextFormatting">applyTextFormatting</a></li><li><a href="global.html#clamp">clamp</a></li><li><a href="global.html#cleanupLinksAfterSlideDelete">cleanupLinksAfterSlideDelete</a></li><li><a href="global.html#clearSelection">clearSelection</a></li><li><a href="global.html#configureDragDrop">configureDragDrop</a></li><li><a href="global.html#configureMoveResize">configureMoveResize</a></li><li><a href="global.html#configureThumbs">configureThumbs</a></li><li><a href="global.html#configureToolbars">configureToolbars</a></li><li><a href="global.html#createTextToolbar">createTextToolbar</a></li><li><a href="global.html#cryptoId">cryptoId</a></li><li><a href="global.html#debounce">debounce</a></li><li><a href="global.html#deleteSelected">deleteSelected</a></li><li><a href="global.html#deleteSlideByIndex">deleteSlideByIndex</a></li><li><a href="global.html#dom">dom</a></li><li><a href="global.html#endMove">endMove</a></li><li><a href="global.html#endResize">endResize</a></li><li><a href="global.html#getActive">getActive</a></li><li><a href="global.html#getElementClasses">getElementClasses</a></li><li><a href="global.html#getElementStyles">getElementStyles</a></li><li><a href="global.html#getSelectedId">getSelectedId</a></li><li><a href="global.html#getShapeWrapperStyles">getShapeWrapperStyles</a></li><li><a href="global.html#getSlideBackgroundStyle">getSlideBackgroundStyle</a></li><li><a href="global.html#getZoom">getZoom</a></li><li><a href="global.html#hrefToTarget">hrefToTarget</a></li><li><a href="global.html#initUI">initUI</a></li><li><a href="global.html#installCameraControls">installCameraControls</a></li><li><a href="global.html#installInteractions">installInteractions</a></li><li><a href="global.html#linkToSlideIndex">linkToSlideIndex</a></li><li><a href="global.html#loadSlidesStateFromLocalStorage">loadSlidesStateFromLocalStorage</a></li><li><a href="global.html#loadState">loadState</a></li><li><a href="global.html#lockPointerEvents">lockPointerEvents</a></li><li><a href="global.html#lockPointerEventsDeep">lockPointerEventsDeep</a></li><li><a href="global.html#onMove">onMove</a></li><li><a href="global.html#onResize">onResize</a></li><li><a href="global.html#px">px</a></li><li><a href="global.html#readSlideMeta">readSlideMeta</a></li><li><a href="global.html#render">render</a></li><li><a href="global.html#renderConnections">renderConnections</a></li><li><a href="global.html#renderNodes">renderNodes</a></li><li><a href="global.html#renderSidebar">renderSidebar</a></li><li><a href="global.html#renderThumbs">renderThumbs</a></li><li><a href="global.html#requestSave">requestSave</a></li><li><a href="global.html#saveSlidesStateToLocalStorage">saveSlidesStateToLocalStorage</a></li><li><a href="global.html#saveState">saveState</a></li><li><a href="global.html#searchEl">searchEl</a></li><li><a href="global.html#select">select</a></li><li><a href="global.html#setElementLinkInSlidesState">setElementLinkInSlidesState</a></li><li><a href="global.html#setSelectedId">setSelectedId</a></li><li><a href="global.html#setSlidePos">setSlidePos</a></li><li><a href="global.html#setSlideTitle">setSlideTitle</a></li><li><a href="global.html#setZoom">setZoom</a></li><li><a href="global.html#slideEl">slideEl</a></li><li><a href="global.html#slideId">slideId</a></li><li><a href="global.html#slideIndexToLink">slideIndexToLink</a></li><li><a href="global.html#startDrag">startDrag</a></li><li><a href="global.html#startMove">startMove</a></li><li><a href="global.html#startResize">startResize</a></li><li><a href="global.html#state">state</a></li><li><a href="global.html#stylesToString">stylesToString</a></li><li><a href="global.html#thumbsEl">thumbsEl</a></li><li><a href="global.html#zoomChip">zoomChip</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>editor/render.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * render.js (editor)
 * Rendu principal de la slide : cr√©ation des n≈ìuds DOM pour chaque √©l√©ment,
 * liaison des toolbars, handles, upload d'images, et sauvegarde d'√©tat.
 * S√©pare logique par type d'√©l√©ment pour rester lisible et maintenable.
 */
// src/JS/editor/render.js
import { getElementStyles, getElementClasses, getSlideBackgroundStyle } from "../styleHelper.js";
import { slideEl, zoomChip } from "./dom.js";
import { getActive, saveState, getSelectedId } from "./core.js";
import { getZoom } from "./zoom.js";
import { createTextToolbar, createTableControls, createShapeControls } from "./toolbars.js";
import { startMove, startResize } from "./moveResize.js";
import { renderThumbs } from "./thumbs.js";

/**
 * render()
 * Fonction principale qui reconstruit la DOM de la slide courante √† partir
 * de l'objet `state`. Pour chaque √©l√©ment de `s.elements` on cr√©√© un
 * conteneur avec les styles/classes appropri√©s puis on ajoute la logique
 * sp√©cifique selon le type (text/button/table/shape/image).
 *
 * Points importants :
 * - Les toolbars sont ajout√©es dynamiquement pour l'√©dition inline
 * - Les handles tl/tr/bl/br d√©clenchent `startResize`
 * - Les √©v√©nements d'upload d'image et de drop sont g√©r√©s localement
 * - On sauvegarde l'√©tat (`saveState`) √† la fin du rendu
 */
export function render() {
  const s = getActive();

  // Applique le background d√©clar√© pour la slide
  slideEl.style.background = getSlideBackgroundStyle(s);

  // Supprime les anciens √©l√©ments (reconstruction compl√®te)
  slideEl.querySelectorAll(".el").forEach((n) => n.remove());

  s.elements.forEach((e) => {
    const node = document.createElement("div");

    // Classe + s√©lection
    node.className = getElementClasses(e) + (e.id === getSelectedId() ? " selected" : "");
    node.dataset.id = e.id;

    // Applique les styles (position/size/font...)
    Object.assign(node.style, getElementStyles(e));

    // --- Texte / Bouton ---
    if (e.type === "text" || e.type === "button") {
      // Contenu editable en place + toolbar d'√©dition
      node.contentEditable = "true";
      node.spellcheck = false;
      node.innerHTML = e.html || (e.type === "text" ? "Texte" : "Bouton");
      node.appendChild(createTextToolbar(e));
    }

    // --- Table ---
    if (e.type === "table") {
      const wrapper = document.createElement("div");
      Object.assign(wrapper.style, {
        width: "100%",
        height: "100%",
        overflow: "hidden",
        position: "relative",
      });

      const tableEl = document.createElement("table");
      tableEl.className = "data-table";
      Object.assign(tableEl.style, {
        width: "100%",
        height: "100%",
        tableLayout: "fixed",
        borderCollapse: "collapse",
      });

      if (e.borderColor) tableEl.style.setProperty("--table-border-color", e.borderColor);

      const rows = e.rows || 3;
      const cols = e.cols || 3;

      // Initialise `e.data` si absent pour √©viter erreurs lors du blur
      if (!e.data) {
        e.data = [];
        for (let i = 0; i &lt; rows; i++) {
          e.data[i] = [];
          for (let j = 0; j &lt; cols; j++) e.data[i][j] = i === 0 ? `Col ${j + 1}` : "";
        }
      }

      for (let i = 0; i &lt; rows; i++) {
        const tr = document.createElement("tr");
        for (let j = 0; j &lt; cols; j++) {
          const cell = i === 0 ? document.createElement("th") : document.createElement("td");
          cell.contentEditable = "true";
          cell.spellcheck = false;
          cell.innerHTML = e.data[i]?.[j] || (i === 0 ? `Col ${j + 1}` : "");
          cell.dataset.row = i;
          cell.dataset.col = j;

          if (i === 0 &amp;&amp; e.headerColor) cell.style.background = e.headerColor;
          if (e.borderColor) cell.style.borderColor = e.borderColor;

          // Lors d'un blur, on persiste la valeur √©dit√©e dans `e.data`
          cell.addEventListener("blur", () => {
            if (!e.data) e.data = Array(rows).fill(null).map(() => Array(cols).fill(""));
            if (!e.data[i]) e.data[i] = Array(cols).fill("");
            e.data[i][j] = cell.innerHTML || cell.textContent;
          });

          tr.appendChild(cell);
        }
        tableEl.appendChild(tr);
      }

      wrapper.appendChild(tableEl);
      node.appendChild(wrapper);

      node.appendChild(createTextToolbar(e));
      node.appendChild(createTableControls(e));
    }

    // --- Shape ---
    if (e.type === "shape") {
      const shapeWrapper = document.createElement("div");
      shapeWrapper.className = "shape-content-wrapper";

      if (e.fillColor) shapeWrapper.style.background = e.fillColor;
      if (e.borderColor) {
        shapeWrapper.style.borderColor = e.borderColor;
        shapeWrapper.style.borderWidth = "2px";
        shapeWrapper.style.borderStyle = "solid";
      }
      if (e.opacity !== undefined) shapeWrapper.style.opacity = e.opacity;

      node.appendChild(shapeWrapper);
      node.appendChild(createShapeControls(e));
    }

    // --- Image ---
    if (e.type === "image") {
      const wrapper = document.createElement("div");
      wrapper.className = "el-img-wrapper";

      wrapper.innerHTML = e.imageData
        ? `&lt;img src="${e.imageData}" style="width:100%;height:100%;object-fit:contain;">`
        : `&lt;div style="padding:12px;text-align:center;line-height:1.2;width:100%;height:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;">
             &lt;span style="font-size:24px;margin-bottom:8px;">üì∏&lt;/span>
             &lt;span style="font-size:13px;font-weight:600;color:#007bff">Double-clique&lt;/span>
           &lt;/div>`;

      node.appendChild(wrapper);
      node.style.cursor = "pointer";

      // Double-clic pour ouvrir un file picker et charger une image en base64
      node.addEventListener("dblclick", (ev) => {
        ev.stopPropagation();
        const input = document.createElement("input");
        input.type = "file";
        input.accept = "image/*";
        input.onchange = (event) => {
          const file = event.target.files[0];
          if (!file) return;
          const reader = new FileReader();
          reader.onload = (loadEvent) => {
            e.imageData = loadEvent.target.result;
            render();
          };
          reader.readAsDataURL(file);
        };
        input.click();
      });

      // Autorise le drop d'une image directement sur l'√©l√©ment
      node.addEventListener("dragover", (ev) => {
        ev.preventDefault();
        ev.stopPropagation();
      });
      node.addEventListener("drop", (ev) => {
        ev.preventDefault();
        ev.stopPropagation();
        const files = ev.dataTransfer.files;
        if (files.length > 0 &amp;&amp; files[0].type.startsWith("image/")) {
          const reader = new FileReader();
          reader.onload = (event) => {
            e.imageData = event.target.result;
            render();
          };
          reader.readAsDataURL(files[0]);
        }
      });
    }

    // --- Handles de redimensionnement ---
    ["tl", "tr", "bl", "br"].forEach((pos) => {
      const h = document.createElement("div");
      h.className = "handle h-" + pos;
      h.dataset.handle = pos;
      h.addEventListener("mousedown", (ev) => startResize(ev, e.id, pos));
      node.appendChild(h);
    });

    // startMove est li√© pour initier le d√©placement (s√©par√© pour la logique)
    node.addEventListener("mousedown", (ev) => {
      if (ev.target.classList.contains("handle")) return;
    });
    node.addEventListener("mousedown", (ev) => startMove(ev, e.id));

    slideEl.appendChild(node);
  });

  // Re-g√©n√®re les miniatures et met √† jour l'affichage du zoom
  renderThumbs();

  const z = getZoom();
  if (zoomChip) zoomChip.textContent = `Zoom: ${Math.round(z * 100)}%`;

  // Persist l'√©tat apr√®s modifications/ajouts
  saveState();
}
</code></pre>
        </article>
    </section>




            </div>
            
            <footer class="footer">
                <div class="content has-text-centered">
                    <p>Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a></p>
                    <p class="sidebar-created-by">
                        <a href="https://github.com/SoftwareBrothers/better-docs" target="_blank">BetterDocs theme</a> provided with <i class="fas fa-heart"></i> by
                        <a href="http://softwarebrothers.co" target="_blank">SoftwareBrothers - JavaScript Development Agency</a>
                    </p>
                </div>
            </footer>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>


</body>
</html>
